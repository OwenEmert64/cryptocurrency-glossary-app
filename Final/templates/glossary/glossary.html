{% extends 'glossary/base.html' %}
{% block content %}
  <h2>Glossary Terms</h2>

  <p><a href="{% url 'create_term' %}">+ Add New Term</a></p>

  <!-- 🧠 Search input -->
  <input type="text" id="searchInput" placeholder="Search terms..." />

  <!-- 🔁 Results container -->
  <ul id="termList">
    {% for term in terms %}
      <li>
        <strong>{{ term.term }}</strong>: {{ term.definition }}
        {% if term.category %}
          <em>({{ term.category }})</em>
        {% endif %}
        {% if request.user == term.added_by %}
          | <a href="{% url 'edit_term' term.id %}">Edit</a>
          | <a href="{% url 'delete_term' term.id %}">Delete</a>
        {% endif %}
      </li>
    {% empty %}
      <li>No terms yet. <a href="{% url 'create_term' %}">Add one now.</a></li>
    {% endfor %}
  </ul>
  <script>
    const searchInput = document.getElementById('searchInput');
    const termList = document.getElementById('termList');
  
    searchInput.addEventListener('input', async () => {
      const query = searchInput.value;
  
      const response = await fetch(`/glossary/search/?q=${encodeURIComponent(query)}`);
      const data = await response.json();
  
      termList.innerHTML = '';
  
      if (data.length === 0) {
        termList.innerHTML = '<li>No matching terms found.</li>';
      } else {
        data.forEach(term => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>${term.term}</strong>: ${term.definition} ${term.category ? `<em>(${term.category})</em>` : ''}`;
          termList.appendChild(li);
        });
      }
    });
  </script>
  
{% endblock %}
